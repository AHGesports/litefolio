---
import Header from "@/components/Header.astro";
import Hero from "@/components/Hero.astro";
import Layout from "@/layouts/Layout.astro";
import Stack from "@/components/Stack.astro";
import Projects from "@/components/Projects.astro";
import About from "@/components/About.astro";
import Footer from "@/components/Footer.astro";
import ContactModal from "@/components/ContactModal.astro";
---

<Layout title="Arshia Hemati - Portfolio">
  <main
    class="relative w-full flex flex-col justify-start pattern"
  >
    <Header />
    <Hero />
    <Stack />
    <Projects />
    <About />
    <Footer />
  </main>

  <!-- Contact Modal -->
  <ContactModal />
</Layout>

<style>
  .pattern {
    --mouse-x: 50%;
    --mouse-y: 0px;

    background-color: #ffffff;
    background-image: radial-gradient(circle at var(--mouse-x) var(--mouse-y), #f5fdff 70px, white),
      repeating-radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        #ffffff,
        #ffffff,
        278px,
        transparent 0,
        #eaeaea 280px
      );
    background-blend-mode: multiply;
    background-size: 100% 100%;
  }
</style>

<script>
  const patternEl = document.querySelector('.pattern') as HTMLElement | null;

  if (patternEl) {
    const pattern = patternEl;
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    if (!prefersReducedMotion) {
      let mouseX = 50;
      let mouseY = 0;
      let currentX = 50;
      let currentY = 0;
      const ease = 0.08;

      // Orbit settings (independent drift)
      const orbitSpeedX = 0.006; // ~17 second cycle
      const orbitSpeedY = 0.0045; // ~23 second cycle
      const orbitRadiusX = 12; // Horizontal drift (%)
      const orbitRadiusY = 60; // Vertical drift (px)
      let time = 0;

      // Track mouse position
      document.addEventListener('mousemove', (e) => {
        mouseX = 50 + ((e.clientX / window.innerWidth) - 0.5) * 20;
        mouseY = ((e.clientY / window.innerHeight) - 0.5) * 100;
      });

      // Smooth animation loop
      function animate() {
        time++;

        // Autonomous orbit (continuous drift)
        const orbitX = Math.sin(time * orbitSpeedX) * orbitRadiusX;
        const orbitY = Math.cos(time * orbitSpeedY) * orbitRadiusY;

        // Combine mouse + orbit
        const targetX = mouseX + orbitX;
        const targetY = mouseY + orbitY;

        // Ease toward target
        currentX += (targetX - currentX) * ease;
        currentY += (targetY - currentY) * ease;

        pattern.style.setProperty('--mouse-x', `${currentX}%`);
        pattern.style.setProperty('--mouse-y', `${currentY}px`);

        requestAnimationFrame(animate);
      }

      animate();
    }
  }
</script>
