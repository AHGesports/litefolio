---
/**
 * Interactive Agent Architecture Visualization
 *
 * Animation System:
 * - CSS transforms for particle movement (not SVG attributes)
 * - stroke-dasharray/dashoffset for line "drawing" effects
 * - HTML divs for particles (better animation support)
 * - JavaScript for timing and sequencing
 */
---

<div class="arch" id="arch">
  <!-- Row 1: Trigger -->
  <div class="row">
    <button class="node trigger" id="trigger" aria-label="Click to trigger full flow">
      <div class="pulse-ring"></div>
      <div class="node-glow"></div>
      <svg class="node-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
      </svg>
      <span>Trigger</span>
    </button>
  </div>

  <!-- Connection 1: Trigger → Workflow -->
  <div class="conn conn-vertical" id="conn1">
    <div class="conn-track"></div>
    <div class="conn-particle"></div>
  </div>

  <!-- Row 2: Workflow -->
  <div class="row">
    <button class="node workflow" id="workflow" aria-label="Click to animate workflow">
      <div class="node-glow"></div>
      <svg class="node-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <!-- Workflow/branching icon -->
        <circle cx="12" cy="5" r="2"></circle>
        <circle cx="6" cy="19" r="2"></circle>
        <circle cx="18" cy="19" r="2"></circle>
        <path d="M12 7v4M12 11l-6 6M12 11l6 6"></path>
      </svg>
      <span>Workflow</span>
    </button>
  </div>

  <!-- Connection 2: Workflow → Agents (branching) -->
  <div class="conn conn-branch" id="conn-branch">
    <svg class="branch-svg" viewBox="0 0 300 60" preserveAspectRatio="none">
      <path class="branch-line branch-l" d="M150 0 C150 30, 50 30, 50 60" />
      <path class="branch-line branch-c" d="M150 0 L150 60" />
      <path class="branch-line branch-r" d="M150 0 C150 30, 250 30, 250 60" />
    </svg>
    <div class="branch-particles">
      <div class="branch-particle bp-l"></div>
      <div class="branch-particle bp-c"></div>
      <div class="branch-particle bp-r"></div>
    </div>
  </div>

  <!-- Row 3: Agents -->
  <div class="row row-spread">
    <button class="node agent" data-idx="0" aria-label="Agent 1">
      <div class="spin-ring"></div>
      <div class="node-glow"></div>
      <svg class="node-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="8" r="4"></circle>
        <path d="M6 20c0-3 3-5 6-5s6 2 6 5"></path>
      </svg>
      <span>Agent</span>
    </button>
    <button class="node agent" data-idx="1" aria-label="Agent 2">
      <div class="spin-ring"></div>
      <div class="node-glow"></div>
      <svg class="node-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="8" r="4"></circle>
        <path d="M6 20c0-3 3-5 6-5s6 2 6 5"></path>
      </svg>
      <span>Agent</span>
    </button>
    <button class="node agent" data-idx="2" aria-label="Agent 3">
      <div class="spin-ring"></div>
      <div class="node-glow"></div>
      <svg class="node-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="8" r="4"></circle>
        <path d="M6 20c0-3 3-5 6-5s6 2 6 5"></path>
      </svg>
      <span>Agent</span>
    </button>
  </div>

  <!-- Connection 3: Agents → DBs (3 vertical lines) -->
  <div class="conn conn-trio" id="conn-trio">
    <svg class="trio-svg" viewBox="0 0 300 30" preserveAspectRatio="none">
      <line class="trio-line" x1="50" y1="0" x2="50" y2="30" />
      <line class="trio-line" x1="150" y1="0" x2="150" y2="30" />
      <line class="trio-line" x1="250" y1="0" x2="250" y2="30" />
    </svg>
    <div class="trio-particles">
      <div class="trio-particle tp-l"></div>
      <div class="trio-particle tp-c"></div>
      <div class="trio-particle tp-r"></div>
    </div>
  </div>

  <!-- Row 4: Isolated DBs -->
  <div class="row row-spread">
    <button class="node db" data-idx="0" aria-label="Isolated DB 1">
      <div class="node-glow"></div>
      <svg class="node-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
        <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
        <path d="M3 12c0 1.66 4 3 9 3s9-1.34 9-3"></path>
      </svg>
      <span>Isolated</span>
    </button>
    <button class="node db" data-idx="1" aria-label="Isolated DB 2">
      <div class="node-glow"></div>
      <svg class="node-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
        <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
        <path d="M3 12c0 1.66 4 3 9 3s9-1.34 9-3"></path>
      </svg>
      <span>Isolated</span>
    </button>
    <button class="node db" data-idx="2" aria-label="Isolated DB 3">
      <div class="node-glow"></div>
      <svg class="node-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
        <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
        <path d="M3 12c0 1.66 4 3 9 3s9-1.34 9-3"></path>
      </svg>
      <span>Isolated</span>
    </button>
  </div>

  <!-- Connection 4: DBs → Shared (merging) -->
  <div class="conn conn-merge" id="conn-merge">
    <svg class="merge-svg" viewBox="0 0 300 50" preserveAspectRatio="none">
      <path class="merge-line merge-l" d="M50 0 C50 25, 150 25, 150 50" />
      <path class="merge-line merge-c" d="M150 0 L150 50" />
      <path class="merge-line merge-r" d="M250 0 C250 25, 150 25, 150 50" />
    </svg>
  </div>

  <!-- Row 5: Shared Platform -->
  <div class="row">
    <button class="node shared" id="shared" aria-label="Synth">
      <div class="node-glow"></div>
      <svg class="node-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="2" y="3" width="20" height="14" rx="2"></rect>
        <path d="M8 21h8M12 17v4"></path>
      </svg>
      <span>Synth</span>
    </button>
  </div>

  <!-- Hint -->
  <p class="hint">Click any node to see the flow</p>
</div>

<style>
  /* ===== LAYOUT ===== */
  .arch {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 16px 12px;
    gap: 0;
    --primary: hsl(252 35% 82%);
    --primary-dim: hsl(252 35% 82% / 0.4);
    --primary-glow: hsl(252 35% 82% / 0.6);
    --line-color: hsl(0 0% 22%);
    --line-active: hsl(252 35% 75% / 0.7);
  }

  @media (min-width: 640px) {
    .arch { padding: 20px 16px; }
  }

  @media (min-width: 1024px) {
    .arch { padding: 32px 24px; }
  }

  .row {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
  }

  .row.row-spread {
    justify-content: space-between;
    width: 85%;
    max-width: 140px;
  }

  @media (min-width: 640px) {
    .row.row-spread { max-width: 200px; }
  }

  @media (min-width: 1024px) {
    .row.row-spread { max-width: 400px; }
  }

  /* ===== NODES ===== */
  .node {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
    padding: 4px 6px;
    background: hsl(0 0% 9%);
    border: 1px solid hsl(0 0% 18%);
    border-radius: 6px;
    cursor: pointer;
    position: relative;
    transition: transform 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
    color: inherit;
    font-family: inherit;
  }

  @media (min-width: 640px) {
    .node {
      padding: 6px 8px;
      gap: 3px;
      border-radius: 8px;
    }
  }

  @media (min-width: 1024px) {
    .node {
      padding: 14px 20px;
      gap: 8px;
      border-radius: 14px;
    }
  }

  .node-icon {
    width: 10px;
    height: 10px;
    stroke: hsl(0 0% 45%);
    transition: stroke 0.2s ease;
  }

  @media (min-width: 640px) {
    .node-icon { width: 14px; height: 14px; }
  }

  @media (min-width: 1024px) {
    .node-icon { width: 28px; height: 28px; }
  }

  .node span {
    font-size: 6px;
    font-weight: 600;
    color: hsl(0 0% 40%);
    text-transform: uppercase;
    letter-spacing: 0.02em;
  }

  @media (min-width: 640px) {
    .node span { font-size: 7px; letter-spacing: 0.04em; }
  }

  @media (min-width: 1024px) {
    .node span { font-size: 10px; letter-spacing: 0.06em; }
  }

  .node:hover {
    border-color: var(--primary-dim);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px hsl(252 30% 70% / 0.2);
  }

  .node:hover .node-icon {
    stroke: hsl(0 0% 80%);
  }

  .node:active {
    transform: translateY(0) scale(0.97);
  }

  /* Node glow effect */
  .node-glow {
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: var(--primary);
    opacity: 0;
    transition: opacity 0.15s ease;
    pointer-events: none;
  }

  .node.active .node-glow {
    animation: glow-pulse 0.4s ease-out;
  }

  @keyframes glow-pulse {
    0% { opacity: 0.3; transform: scale(1); }
    100% { opacity: 0; transform: scale(1.15); }
  }

  /* ===== TRIGGER ===== */
  .node.trigger {
    background: hsl(252 20% 14%);
    border-color: var(--primary-dim);
  }

  .node.trigger .node-icon {
    stroke: var(--primary);
    filter: drop-shadow(0 0 6px var(--primary-glow));
  }

  .pulse-ring {
    position: absolute;
    inset: -4px;
    border: 2px solid var(--primary-dim);
    border-radius: inherit;
    animation: pulse 2.5s ease-out infinite;
    pointer-events: none;
  }

  @keyframes pulse {
    0% { transform: scale(1); opacity: 0.6; }
    100% { transform: scale(1.25); opacity: 0; }
  }

  .node.trigger.firing {
    animation: trigger-fire 0.3s ease-out;
  }

  @keyframes trigger-fire {
    0% { transform: scale(1); box-shadow: 0 0 0 var(--primary-glow); }
    50% { transform: scale(1.08); box-shadow: 0 0 30px var(--primary-glow); }
    100% { transform: scale(1); box-shadow: 0 0 0 var(--primary-glow); }
  }

  /* ===== WORKFLOW ===== */
  .node.workflow .node-icon {
    stroke: hsl(0 0% 55%);
  }

  .node.workflow:hover .node-icon,
  .node.workflow.active .node-icon {
    stroke: var(--primary);
  }

  /* ===== AGENTS ===== */
  .node.agent .node-icon {
    stroke: hsl(252 30% 70%);
  }

  /* Agent processing animation - ripple pulse */
  .spin-ring {
    position: absolute;
    inset: 0;
    border-radius: inherit;
    pointer-events: none;
    opacity: 0;
  }

  .spin-ring::before,
  .spin-ring::after {
    content: '';
    position: absolute;
    inset: -4px;
    border: 2px solid var(--primary);
    border-radius: inherit;
    opacity: 0;
  }

  .node.agent.processing .spin-ring::before {
    animation: ripple-out 0.6s ease-out forwards;
  }

  .node.agent.processing .spin-ring::after {
    animation: ripple-out 0.6s ease-out 0.15s forwards;
  }

  @keyframes ripple-out {
    0% {
      transform: scale(1);
      opacity: 0.8;
    }
    100% {
      transform: scale(1.3);
      opacity: 0;
    }
  }

  /* Agent processing state - icon pulse */
  .node.agent.processing {
    animation: agent-pulse 0.5s ease-out;
  }

  .node.agent.processing .node-icon {
    animation: icon-glow 0.5s ease-out;
  }

  @keyframes agent-pulse {
    0% { transform: scale(1); }
    30% { transform: scale(1.05); }
    100% { transform: scale(1); }
  }

  @keyframes icon-glow {
    0% { filter: drop-shadow(0 0 0 var(--primary)); }
    30% { filter: drop-shadow(0 0 12px var(--primary)); stroke: var(--primary); }
    100% { filter: drop-shadow(0 0 4px var(--primary-glow)); }
  }

  /* ===== DATABASES ===== */
  .node.db {
    background: hsl(252 15% 12%);
    border-color: hsl(252 30% 70% / 0.25);
  }

  .node.db .node-icon {
    stroke: hsl(252 30% 70%);
  }

  .node.db.active {
    border-color: var(--primary-dim);
    box-shadow: 0 0 20px hsl(252 30% 75% / 0.25);
  }

  /* ===== SHARED ===== */
  .node.shared {
    padding: 4px 8px;
  }

  @media (min-width: 640px) {
    .node.shared { padding: 6px 10px; }
  }

  @media (min-width: 1024px) {
    .node.shared { padding: 14px 24px; }
  }

  .node.shared.active {
    border-color: var(--primary-dim);
    box-shadow: 0 0 25px hsl(252 30% 75% / 0.3);
  }

  /* ===== CONNECTIONS ===== */

  /* Vertical connection */
  .conn-vertical {
    width: 2px;
    height: 10px;
    position: relative;
    display: flex;
    justify-content: center;
  }

  @media (min-width: 640px) {
    .conn-vertical { height: 16px; }
  }

  @media (min-width: 1024px) {
    .conn-vertical { height: 36px; }
  }

  .conn-track {
    width: 2px;
    height: 100%;
    background: linear-gradient(180deg, var(--line-active) 0%, var(--line-color) 100%);
    border-radius: 1px;
  }

  .conn-particle {
    position: absolute;
    width: 4px;
    height: 4px;
    background: var(--primary);
    border-radius: 50%;
    top: 0;
    left: 50%;
    transform: translateX(-50%) translateY(-50%);
    opacity: 0;
    box-shadow: 0 0 4px var(--primary);
    pointer-events: none;
  }

  @media (min-width: 640px) {
    .conn-particle { width: 5px; height: 5px; box-shadow: 0 0 6px var(--primary); }
  }

  @media (min-width: 1024px) {
    .conn-particle { width: 8px; height: 8px; box-shadow: 0 0 10px var(--primary); }
  }

  /* Idle animation - particle travels down */
  .conn-vertical .conn-particle {
    animation: particle-idle 2.5s ease-in-out infinite;
  }

  @keyframes particle-idle {
    0%, 100% { top: 0%; opacity: 0; }
    10% { opacity: 1; }
    85% { opacity: 1; }
    95% { top: 100%; opacity: 0; }
  }

  /* Active flow animation */
  .conn-vertical.flowing .conn-particle {
    animation: particle-flow 0.4s ease-out forwards;
  }

  @keyframes particle-flow {
    0% { top: 0%; opacity: 1; }
    100% { top: 100%; opacity: 0; }
  }

  /* ===== BRANCH CONNECTION ===== */
  .conn-branch {
    width: 85%;
    max-width: 140px;
    height: 24px;
    position: relative;
  }

  @media (min-width: 640px) {
    .conn-branch { max-width: 200px; height: 32px; }
  }

  @media (min-width: 1024px) {
    .conn-branch { max-width: 400px; height: 65px; }
  }

  .branch-svg {
    width: 100%;
    height: 100%;
    overflow: visible;
  }

  .branch-line {
    fill: none;
    stroke: var(--line-color);
    stroke-width: 2;
    stroke-linecap: round;
    transition: stroke 0.2s ease;
  }

  /* Stroke dash animation for "drawing" effect */
  .branch-line {
    stroke-dasharray: 150;
    stroke-dashoffset: 0;
  }

  .conn-branch.flowing .branch-line {
    stroke: var(--line-active);
    animation: draw-line 0.5s ease-out;
  }

  @keyframes draw-line {
    0% { stroke-dashoffset: 150; stroke: var(--primary); }
    100% { stroke-dashoffset: 0; stroke: var(--line-active); }
  }

  /* Branch particles */
  .branch-particles {
    position: absolute;
    inset: 0;
    pointer-events: none;
  }

  .branch-particle {
    position: absolute;
    width: 4px;
    height: 4px;
    background: var(--primary);
    border-radius: 50%;
    opacity: 0;
    box-shadow: 0 0 4px var(--primary);
  }

  @media (min-width: 640px) {
    .branch-particle { width: 5px; height: 5px; box-shadow: 0 0 6px var(--primary); }
  }

  @media (min-width: 1024px) {
    .branch-particle { width: 8px; height: 8px; box-shadow: 0 0 10px var(--primary); }
  }

  .bp-l { left: 50%; top: 0; }
  .bp-c { left: 50%; top: 0; }
  .bp-r { left: 50%; top: 0; }

  .conn-branch.flowing .bp-l {
    animation: branch-flow-l 0.5s ease-out forwards;
  }
  .conn-branch.flowing .bp-c {
    animation: branch-flow-c 0.5s ease-out 0.05s forwards;
  }
  .conn-branch.flowing .bp-r {
    animation: branch-flow-r 0.5s ease-out 0.1s forwards;
  }

  @keyframes branch-flow-l {
    0% { left: 50%; top: 0%; opacity: 1; transform: translate(-50%, -50%); }
    100% { left: 16.67%; top: 100%; opacity: 0; transform: translate(-50%, -50%); }
  }

  @keyframes branch-flow-c {
    0% { left: 50%; top: 0%; opacity: 1; transform: translate(-50%, -50%); }
    100% { left: 50%; top: 100%; opacity: 0; transform: translate(-50%, -50%); }
  }

  @keyframes branch-flow-r {
    0% { left: 50%; top: 0%; opacity: 1; transform: translate(-50%, -50%); }
    100% { left: 83.33%; top: 100%; opacity: 0; transform: translate(-50%, -50%); }
  }

  /* ===== TRIO CONNECTION (Agents → DBs) ===== */
  .conn-trio {
    width: 85%;
    max-width: 140px;
    height: 10px;
    position: relative;
  }

  @media (min-width: 640px) {
    .conn-trio { max-width: 200px; height: 14px; }
  }

  @media (min-width: 1024px) {
    .conn-trio { max-width: 400px; height: 30px; }
  }

  .trio-svg {
    width: 100%;
    height: 100%;
    overflow: visible;
  }

  .trio-svg .trio-line {
    stroke: var(--line-color);
    stroke-width: 2;
    stroke-linecap: round;
    transition: stroke 0.2s ease;
  }

  .conn-trio.flowing .trio-svg .trio-line {
    stroke: var(--line-active);
  }

  /* Trio particles */
  .trio-particles {
    position: absolute;
    inset: 0;
    pointer-events: none;
  }

  .trio-particle {
    position: absolute;
    width: 4px;
    height: 4px;
    background: var(--primary);
    border-radius: 50%;
    opacity: 0;
    box-shadow: 0 0 4px var(--primary);
    transform: translate(-50%, -50%);
  }

  @media (min-width: 640px) {
    .trio-particle { width: 5px; height: 5px; box-shadow: 0 0 6px var(--primary); }
  }

  @media (min-width: 1024px) {
    .trio-particle { width: 8px; height: 8px; box-shadow: 0 0 10px var(--primary); }
  }

  .tp-l { left: 16.67%; top: 0; }
  .tp-c { left: 50%; top: 0; }
  .tp-r { left: 83.33%; top: 0; }

  .conn-trio.flowing .tp-l {
    animation: trio-flow 0.35s ease-out forwards;
  }
  .conn-trio.flowing .tp-c {
    animation: trio-flow 0.35s ease-out 0.08s forwards;
  }
  .conn-trio.flowing .tp-r {
    animation: trio-flow 0.35s ease-out 0.16s forwards;
  }

  @keyframes trio-flow {
    0% { top: 0%; opacity: 1; }
    100% { top: 100%; opacity: 0; }
  }

  /* ===== MERGE CONNECTION ===== */
  .conn-merge {
    width: 85%;
    max-width: 140px;
    height: 18px;
    position: relative;
  }

  @media (min-width: 640px) {
    .conn-merge { max-width: 200px; height: 24px; }
  }

  @media (min-width: 1024px) {
    .conn-merge { max-width: 400px; height: 50px; }
  }

  .merge-svg {
    width: 100%;
    height: 100%;
    overflow: visible;
  }

  .merge-line {
    fill: none;
    stroke: var(--line-color);
    stroke-width: 2;
    stroke-linecap: round;
    stroke-dasharray: 120;
    stroke-dashoffset: 0;
  }

  .conn-merge.flowing .merge-line {
    stroke: var(--line-active);
    animation: draw-merge 0.4s ease-out;
  }

  @keyframes draw-merge {
    0% { stroke-dashoffset: 120; stroke: var(--primary); }
    100% { stroke-dashoffset: 0; stroke: var(--line-active); }
  }

  /* ===== HINT ===== */
  .hint {
    margin-top: 6px;
    font-size: 6px;
    color: hsl(0 0% 35%);
    text-transform: uppercase;
    letter-spacing: 0.06em;
    opacity: 0.6;
    transition: opacity 0.3s ease;
  }

  @media (min-width: 640px) {
    .hint { margin-top: 10px; font-size: 8px; }
  }

  @media (min-width: 1024px) {
    .hint { margin-top: 20px; font-size: 11px; }
  }

  .arch:hover .hint {
    opacity: 0.9;
  }

  /* ===== REDUCED MOTION ===== */
  @media (prefers-reduced-motion: reduce) {
    .pulse-ring,
    .conn-particle,
    .branch-particle,
    .spin-ring {
      animation: none !important;
    }
    .node, .conn-track, .branch-line, .merge-line {
      transition: none !important;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Elements
    const trigger = document.getElementById('trigger');
    const workflow = document.getElementById('workflow');
    const conn1 = document.getElementById('conn1');
    const connBranch = document.getElementById('conn-branch');
    const connTrio = document.getElementById('conn-trio');
    const connMerge = document.getElementById('conn-merge');
    const shared = document.getElementById('shared');
    const agents = document.querySelectorAll('.node.agent');
    const dbs = document.querySelectorAll('.node.db');

    // Helper: add class temporarily
    function flash(el: Element | null, className: string, duration: number) {
      if (!el) return;
      el.classList.add(className);
      setTimeout(() => el.classList.remove(className), duration);
    }

    // TRIGGER: Full cascade animation
    trigger?.addEventListener('click', () => {
      flash(trigger, 'firing', 300);

      // Step 1: Connection to workflow
      setTimeout(() => flash(conn1, 'flowing', 400), 100);
      setTimeout(() => flash(workflow, 'active', 400), 300);

      // Step 2: Branch to agents
      setTimeout(() => flash(connBranch, 'flowing', 600), 500);

      // Step 3: Agents process (staggered ripple effect)
      setTimeout(() => {
        agents.forEach((a, i) => {
          setTimeout(() => flash(a, 'processing', 650), i * 120);
        });
      }, 850);

      // Step 4: Trio connection to DBs
      setTimeout(() => flash(connTrio, 'flowing', 500), 1300);

      // Step 5: DBs receive
      setTimeout(() => {
        dbs.forEach((d, i) => {
          setTimeout(() => flash(d, 'active', 500), i * 100);
        });
      }, 1550);

      // Step 6: Merge to shared
      setTimeout(() => flash(connMerge, 'flowing', 500), 1800);

      // Step 7: Shared receives
      setTimeout(() => flash(shared, 'active', 600), 2050);
    });

    // WORKFLOW: Branch animation
    workflow?.addEventListener('click', () => {
      flash(workflow, 'active', 300);
      setTimeout(() => flash(connBranch, 'flowing', 600), 100);
      setTimeout(() => {
        agents.forEach((a, i) => {
          setTimeout(() => flash(a, 'processing', 650), i * 120);
        });
      }, 500);
    });

    // AGENTS: Process and flow to their DB
    agents.forEach((agent, idx) => {
      agent.addEventListener('click', () => {
        flash(agent, 'processing', 650);

        setTimeout(() => flash(connTrio, 'flowing', 500), 350);
        setTimeout(() => flash(dbs[idx], 'active', 500), 600);
      });
    });

    // DBs: Glow and merge to shared
    dbs.forEach(db => {
      db.addEventListener('click', () => {
        flash(db, 'active', 500);
        setTimeout(() => flash(connMerge, 'flowing', 500), 200);
        setTimeout(() => flash(shared, 'active', 600), 500);
      });
    });

    // SHARED: Just glow
    shared?.addEventListener('click', () => {
      flash(shared, 'active', 600);
    });
  });
</script>
