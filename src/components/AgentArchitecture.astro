---
// Agent Architecture Visualization - Interactive flowchart showing data flow
---

<div class="arch" id="arch">
  <div class="row">
    <button class="node trigger" id="trigger" aria-label="Start the flow animation">
      <svg class="node-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
      </svg>
      <span>Trigger</span>
    </button>
  </div>

  <div class="conn conn-vertical" id="conn1">
    <div class="conn-track"></div>
    <div class="conn-particle"></div>
  </div>

  <div class="row">
    <button class="node workflow" id="workflow" aria-label="Workflow orchestration">
      <svg class="node-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="5" r="2"></circle>
        <circle cx="6" cy="19" r="2"></circle>
        <circle cx="18" cy="19" r="2"></circle>
        <path d="M12 7v4M12 11l-6 6M12 11l6 6"></path>
      </svg>
      <span>Workflow</span>
    </button>
  </div>

  <div class="conn conn-branch" id="conn-branch">
    <svg class="branch-svg" viewBox="0 0 300 60" preserveAspectRatio="none">
      <path class="branch-line" d="M150 0 C150 30, 50 30, 50 60" />
      <path class="branch-line" d="M150 0 L150 60" />
      <path class="branch-line" d="M150 0 C150 30, 250 30, 250 60" />
    </svg>
    <div class="branch-particles">
      <div class="branch-particle bp-l"></div>
      <div class="branch-particle bp-c"></div>
      <div class="branch-particle bp-r"></div>
    </div>
  </div>

  <div class="row row-spread">
    <button class="node agent" data-idx="0" aria-label="AI Agent instance">
      <svg class="node-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="8" r="4"></circle>
        <path d="M6 20c0-3 3-5 6-5s6 2 6 5"></path>
      </svg>
      <span>Agent</span>
    </button>
    <button class="node agent" data-idx="1" aria-label="AI Agent instance">
      <svg class="node-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="8" r="4"></circle>
        <path d="M6 20c0-3 3-5 6-5s6 2 6 5"></path>
      </svg>
      <span>Agent</span>
    </button>
    <button class="node agent" data-idx="2" aria-label="AI Agent instance">
      <svg class="node-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="8" r="4"></circle>
        <path d="M6 20c0-3 3-5 6-5s6 2 6 5"></path>
      </svg>
      <span>Agent</span>
    </button>
  </div>

  <div class="conn conn-trio" id="conn-trio">
    <svg class="trio-svg" viewBox="0 0 300 30" preserveAspectRatio="none">
      <line class="trio-line" x1="50" y1="0" x2="50" y2="30" />
      <line class="trio-line" x1="150" y1="0" x2="150" y2="30" />
      <line class="trio-line" x1="250" y1="0" x2="250" y2="30" />
    </svg>
    <div class="trio-particles">
      <div class="trio-particle tp-l"></div>
      <div class="trio-particle tp-c"></div>
      <div class="trio-particle tp-r"></div>
    </div>
  </div>

  <div class="row row-spread">
    <button class="node db" data-idx="0" aria-label="Isolated database">
      <svg class="node-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
        <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
        <path d="M3 12c0 1.66 4 3 9 3s9-1.34 9-3"></path>
      </svg>
      <span>Isolated</span>
    </button>
    <button class="node db" data-idx="1" aria-label="Isolated database">
      <svg class="node-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
        <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
        <path d="M3 12c0 1.66 4 3 9 3s9-1.34 9-3"></path>
      </svg>
      <span>Isolated</span>
    </button>
    <button class="node db" data-idx="2" aria-label="Isolated database">
      <svg class="node-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
        <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
        <path d="M3 12c0 1.66 4 3 9 3s9-1.34 9-3"></path>
      </svg>
      <span>Isolated</span>
    </button>
  </div>

  <div class="conn conn-merge" id="conn-merge">
    <svg class="merge-svg" viewBox="0 0 300 50" preserveAspectRatio="none">
      <path class="merge-line" d="M50 0 C50 25, 150 25, 150 50" />
      <path class="merge-line" d="M150 0 L150 50" />
      <path class="merge-line" d="M250 0 C250 25, 150 25, 150 50" />
    </svg>
  </div>

  <div class="row">
    <button class="node shared" id="shared" aria-label="Synth platform">
      <svg class="node-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="2" y="3" width="20" height="14" rx="2"></rect>
        <path d="M8 21h8M12 17v4"></path>
      </svg>
      <span>Synth</span>
    </button>
  </div>

  <button type="button" class="hint" id="hint-trigger">
    click to trigger workflow <i class="hint-icon">↗</i>
  </button>
</div>

<style>
  /* ===== LAYOUT ===== */
  .arch {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 8px 4px;
    gap: 0;
    --primary: hsl(0 0% 90%);
    --line-color: hsl(0 0% 35%);
    --line-active: hsl(0 0% 55%);
  }

  @container (min-width: 150px) {
    .arch { padding: 10px 6px; }
  }

  @container (min-width: 190px) {
    .arch { padding: 12px 8px; }
  }

  @container (min-width: 280px) {
    .arch { padding: 16px 14px; }
  }

  @container (min-width: 420px) {
    .arch { padding: 32px 24px; }
  }

  .row {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
  }

  .row.row-spread {
    justify-content: space-between;
    width: 92%;
    max-width: 140px;
  }

  @container (min-width: 150px) {
    .row.row-spread { max-width: 155px; }
  }

  @container (min-width: 190px) {
    .row.row-spread { max-width: 185px; }
  }

  @container (min-width: 280px) {
    .row.row-spread { max-width: 260px; }
  }

  @container (min-width: 420px) {
    .row.row-spread { max-width: 380px; }
  }

  /* ===== NODES ===== */
  .node {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1px;
    padding: 3px 5px;
    background: hsl(0 0% 100%);
    border: 1px solid hsl(0 0% 80%);
    border-radius: 9999px;
    cursor: pointer;
    position: relative;
    transition: all 0.3s ease-in-out;
    color: inherit;
    font-family: inherit;
  }

  @container (min-width: 150px) {
    .node {
      padding: 4px 7px;
      gap: 2px;
    }
  }

  @container (min-width: 190px) {
    .node {
      padding: 5px 9px;
      gap: 2px;
    }
  }

  @container (min-width: 280px) {
    .node {
      padding: 6px 12px;
      gap: 4px;
    }
  }

  @container (min-width: 420px) {
    .node {
      padding: 10px 18px;
      gap: 6px;
    }
  }

  .node-icon {
    width: 9px;
    height: 9px;
    stroke: hsl(0 0% 40%);
    transition: all 0.3s ease-in-out;
    flex-shrink: 0;
  }

  @container (min-width: 150px) {
    .node-icon { width: 10px; height: 10px; }
  }

  @container (min-width: 190px) {
    .node-icon { width: 12px; height: 12px; }
  }

  @container (min-width: 280px) {
    .node-icon { width: 14px; height: 14px; }
  }

  @container (min-width: 420px) {
    .node-icon { width: 18px; height: 18px; }
  }

  .node span {
    font-size: 5px;
    font-weight: 300;
    color: hsl(0 0% 30%);
    letter-spacing: -0.02em;
    white-space: nowrap;
  }

  @container (min-width: 150px) {
    .node span { font-size: 6px; }
  }

  @container (min-width: 190px) {
    .node span { font-size: 7px; }
  }

  @container (min-width: 280px) {
    .node span { font-size: 11px; }
  }

  @container (min-width: 420px) {
    .node span { font-size: 14px; }
  }

  .node:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 15px hsl(0 0% 0% / 0.12);
  }

  .node:hover .node-icon {
    stroke: hsl(0 0% 20%);
  }

  .node:active {
    transform: scale(0.98);
  }

  .node.active {
    box-shadow: 0 4px 15px hsl(0 0% 0% / 0.12);
  }

  /* ===== TRIGGER ===== */
  .node.trigger {
    background: hsl(0 0% 100%);
    border-color: hsl(0 0% 75%);
  }

  .node.trigger .node-icon {
    stroke: hsl(0 0% 30%);
  }

  .node.trigger.firing {
    animation: trigger-fire 0.25s ease-out;
  }

  @keyframes trigger-fire {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); box-shadow: 0 6px 20px hsl(0 0% 0% / 0.15); }
    100% { transform: scale(1); }
  }

  /* ===== WORKFLOW ===== */
  .node.workflow .node-icon {
    stroke: hsl(0 0% 35%);
  }

  .node.workflow:hover .node-icon,
  .node.workflow.active .node-icon {
    stroke: hsl(0 0% 20%);
  }

  /* ===== AGENTS ===== */
  .node.agent .node-icon {
    stroke: hsl(0 0% 40%);
  }

  .node.agent.processing {
    animation: agent-pulse 0.4s ease-out;
    box-shadow: 0 4px 15px hsl(0 0% 0% / 0.12);
  }

  @keyframes agent-pulse {
    0% { transform: scale(1); }
    40% { transform: scale(1.08); }
    100% { transform: scale(1); }
  }

  /* ===== DATABASES ===== */
  .node.db {
    background: hsl(0 0% 100%);
    border-color: hsl(0 0% 80%);
  }

  .node.db .node-icon {
    stroke: hsl(0 0% 40%);
  }

  .node.db.active {
    box-shadow: 0 4px 15px hsl(0 0% 0% / 0.12);
  }

  /* ===== SHARED ===== */
  .node.shared {
    background: hsl(0 0% 100%);
    border-color: hsl(0 0% 75%);
  }

  .node.shared.active {
    box-shadow: 0 4px 15px hsl(0 0% 0% / 0.12);
  }

  /* ===== CONNECTIONS ===== */

  /* Vertical connection */
  .conn-vertical {
    width: 2px;
    height: 14px;
    position: relative;
    display: flex;
    justify-content: center;
  }

  @container (min-width: 150px) {
    .conn-vertical { height: 16px; }
  }

  @container (min-width: 190px) {
    .conn-vertical { height: 20px; }
  }

  @container (min-width: 280px) {
    .conn-vertical { height: 28px; }
  }

  @container (min-width: 420px) {
    .conn-vertical { height: 44px; }
  }

  .conn-track {
    width: 2px;
    height: 100%;
    background: linear-gradient(180deg, var(--line-active) 0%, var(--line-color) 100%);
    border-radius: 1px;
  }

  .conn-particle {
    position: absolute;
    width: 2px;
    height: 2px;
    background: hsl(0 0% 50%);
    border-radius: 50%;
    top: 0;
    left: 50%;
    transform: translateX(-50%) translateY(-50%);
    opacity: 0;
    pointer-events: none;
  }

  @container (min-width: 150px) {
    .conn-particle { width: 2px; height: 2px; }
  }

  @container (min-width: 190px) {
    .conn-particle { width: 3px; height: 3px; }
  }

  @container (min-width: 280px) {
    .conn-particle { width: 5px; height: 5px; }
  }

  /* Active flow animation - only on click */
  .conn-vertical.flowing .conn-particle {
    animation: particle-flow 0.4s ease-out forwards;
  }

  @keyframes particle-flow {
    0% { top: 0%; opacity: 1; }
    100% { top: 100%; opacity: 0; }
  }

  /* ===== BRANCH CONNECTION ===== */
  .conn-branch {
    width: 92%;
    max-width: 140px;
    height: 22px;
    position: relative;
  }

  @container (min-width: 150px) {
    .conn-branch { max-width: 155px; height: 26px; }
  }

  @container (min-width: 190px) {
    .conn-branch { max-width: 185px; height: 32px; }
  }

  @container (min-width: 280px) {
    .conn-branch { max-width: 260px; height: 45px; }
  }

  @container (min-width: 420px) {
    .conn-branch { max-width: 380px; height: 70px; }
  }

  .branch-svg {
    width: 100%;
    height: 100%;
    overflow: visible;
  }

  .branch-line {
    fill: none;
    stroke: var(--line-color);
    stroke-width: 2;
    stroke-linecap: round;
    transition: stroke 0.2s ease;
  }

  /* Stroke dash animation for "drawing" effect */
  .branch-line {
    stroke-dasharray: 150;
    stroke-dashoffset: 0;
  }

  .conn-branch.flowing .branch-line {
    stroke: var(--line-active);
    animation: draw-line 0.5s ease-out;
  }

  @keyframes draw-line {
    0% { stroke-dashoffset: 150; stroke: var(--primary); }
    100% { stroke-dashoffset: 0; stroke: var(--line-active); }
  }

  /* Branch particles */
  .branch-particles {
    position: absolute;
    inset: 0;
    pointer-events: none;
  }

  .branch-particle {
    position: absolute;
    width: 2px;
    height: 2px;
    background: hsl(0 0% 50%);
    border-radius: 50%;
    opacity: 0;
  }

  @container (min-width: 190px) {
    .branch-particle { width: 3px; height: 3px; }
  }

  @container (min-width: 280px) {
    .branch-particle { width: 5px; height: 5px; }
  }

  .bp-l { left: 50%; top: 0; }
  .bp-c { left: 50%; top: 0; }
  .bp-r { left: 50%; top: 0; }

  .conn-branch.flowing .bp-l {
    animation: branch-flow-l 0.5s ease-out forwards;
  }
  .conn-branch.flowing .bp-c {
    animation: branch-flow-c 0.5s ease-out 0.05s forwards;
  }
  .conn-branch.flowing .bp-r {
    animation: branch-flow-r 0.5s ease-out 0.1s forwards;
  }

  @keyframes branch-flow-l {
    0% { left: 50%; top: 0%; opacity: 1; transform: translate(-50%, -50%); }
    100% { left: 16.67%; top: 100%; opacity: 0; transform: translate(-50%, -50%); }
  }

  @keyframes branch-flow-c {
    0% { left: 50%; top: 0%; opacity: 1; transform: translate(-50%, -50%); }
    100% { left: 50%; top: 100%; opacity: 0; transform: translate(-50%, -50%); }
  }

  @keyframes branch-flow-r {
    0% { left: 50%; top: 0%; opacity: 1; transform: translate(-50%, -50%); }
    100% { left: 83.33%; top: 100%; opacity: 0; transform: translate(-50%, -50%); }
  }

  /* ===== TRIO CONNECTION (Agents → DBs) ===== */
  .conn-trio {
    width: 92%;
    max-width: 140px;
    height: 12px;
    position: relative;
  }

  @container (min-width: 150px) {
    .conn-trio { max-width: 155px; height: 14px; }
  }

  @container (min-width: 190px) {
    .conn-trio { max-width: 185px; height: 18px; }
  }

  @container (min-width: 280px) {
    .conn-trio { max-width: 260px; height: 24px; }
  }

  @container (min-width: 420px) {
    .conn-trio { max-width: 380px; height: 36px; }
  }

  .trio-svg {
    width: 100%;
    height: 100%;
    overflow: visible;
  }

  .trio-svg .trio-line {
    stroke: var(--line-color);
    stroke-width: 2;
    stroke-linecap: round;
    transition: stroke 0.2s ease;
  }

  .conn-trio.flowing .trio-svg .trio-line {
    stroke: var(--line-active);
  }

  /* Trio particles */
  .trio-particles {
    position: absolute;
    inset: 0;
    pointer-events: none;
  }

  .trio-particle {
    position: absolute;
    width: 2px;
    height: 2px;
    background: hsl(0 0% 50%);
    border-radius: 50%;
    opacity: 0;
    transform: translate(-50%, -50%);
  }

  @container (min-width: 190px) {
    .trio-particle { width: 3px; height: 3px; }
  }

  @container (min-width: 280px) {
    .trio-particle { width: 5px; height: 5px; }
  }

  .tp-l { left: 16.67%; top: 0; }
  .tp-c { left: 50%; top: 0; }
  .tp-r { left: 83.33%; top: 0; }

  .conn-trio.flowing .tp-l {
    animation: trio-flow 0.35s ease-out forwards;
  }
  .conn-trio.flowing .tp-c {
    animation: trio-flow 0.35s ease-out 0.08s forwards;
  }
  .conn-trio.flowing .tp-r {
    animation: trio-flow 0.35s ease-out 0.16s forwards;
  }

  @keyframes trio-flow {
    0% { top: 0%; opacity: 1; }
    100% { top: 100%; opacity: 0; }
  }

  /* ===== MERGE CONNECTION ===== */
  .conn-merge {
    width: 92%;
    max-width: 140px;
    height: 16px;
    position: relative;
  }

  @container (min-width: 150px) {
    .conn-merge { max-width: 155px; height: 20px; }
  }

  @container (min-width: 190px) {
    .conn-merge { max-width: 185px; height: 26px; }
  }

  @container (min-width: 280px) {
    .conn-merge { max-width: 260px; height: 35px; }
  }

  @container (min-width: 420px) {
    .conn-merge { max-width: 380px; height: 55px; }
  }

  .merge-svg {
    width: 100%;
    height: 100%;
    overflow: visible;
  }

  .merge-line {
    fill: none;
    stroke: var(--line-color);
    stroke-width: 2;
    stroke-linecap: round;
    stroke-dasharray: 120;
    stroke-dashoffset: 0;
  }

  .conn-merge.flowing .merge-line {
    stroke: var(--line-active);
    animation: draw-merge 0.4s ease-out;
  }

  @keyframes draw-merge {
    0% { stroke-dashoffset: 120; stroke: var(--primary); }
    100% { stroke-dashoffset: 0; stroke: var(--line-active); }
  }

  /* ===== HINT ===== */
  .hint {
    position: absolute;
    bottom: 6px;
    left: 8px;
    font-size: 5px;
    color: hsl(0 0% 50%);
    font-weight: 300;
    letter-spacing: -0.01em;
    cursor: pointer;
    transition: color 0.2s ease;
    border: none;
    background: none;
    padding: 2px 4px;
    font-family: inherit;
    white-space: nowrap;
  }

  .hint:hover {
    color: hsl(0 0% 30%);
  }

  .hint-icon {
    font-style: normal;
    display: inline-block;
    transition: transform 0.2s ease;
    vertical-align: middle;
    position: relative;
    top: -0.05em;
  }

  @container (min-width: 280px) {
    .hint-icon {
      top: 0;
    }
  }

  .hint:hover .hint-icon {
    transform: translate(0.1em, -0.1em);
  }

  @container (min-width: 150px) {
    .hint { bottom: 8px; left: 10px; font-size: 6px; }
  }

  @container (min-width: 190px) {
    .hint { bottom: 10px; left: 12px; font-size: 7px; }
  }

  @container (min-width: 280px) {
    .hint { bottom: 12px; left: 16px; font-size: 9px; }
  }

  @container (min-width: 420px) {
    .hint { bottom: 16px; left: 20px; font-size: 11px; }
  }

  /* ===== REDUCED MOTION ===== */
  @media (prefers-reduced-motion: reduce) {
    .conn-particle,
    .branch-particle,
    .trio-particle,
    .node {
      animation: none !important;
    }
    * {
      transition-duration: 0.01ms !important;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Elements
    const trigger = document.getElementById('trigger');
    const workflow = document.getElementById('workflow');
    const conn1 = document.getElementById('conn1');
    const connBranch = document.getElementById('conn-branch');
    const connTrio = document.getElementById('conn-trio');
    const connMerge = document.getElementById('conn-merge');
    const shared = document.getElementById('shared');
    const hintTrigger = document.getElementById('hint-trigger');
    const agents = document.querySelectorAll('.node.agent');
    const dbs = document.querySelectorAll('.node.db');

    // Helper: add class temporarily
    function flash(el: Element | null, className: string, duration: number) {
      if (!el) return;
      el.classList.add(className);
      setTimeout(() => el.classList.remove(className), duration);
    }

    // Full cascade animation function
    function runFullAnimation() {
      flash(trigger, 'firing', 300);

      // Step 1: Connection to workflow
      setTimeout(() => flash(conn1, 'flowing', 400), 100);
      setTimeout(() => flash(workflow, 'active', 400), 300);

      // Step 2: Branch to agents
      setTimeout(() => flash(connBranch, 'flowing', 600), 500);

      // Step 3: Agents process (staggered ripple effect)
      setTimeout(() => {
        agents.forEach((a, i) => {
          setTimeout(() => flash(a, 'processing', 650), i * 120);
        });
      }, 850);

      // Step 4: Trio connection to DBs
      setTimeout(() => flash(connTrio, 'flowing', 500), 1300);

      // Step 5: DBs receive
      setTimeout(() => {
        dbs.forEach((d, i) => {
          setTimeout(() => flash(d, 'active', 500), i * 100);
        });
      }, 1550);

      // Step 6: Merge to shared
      setTimeout(() => flash(connMerge, 'flowing', 500), 1800);

      // Step 7: Shared receives
      setTimeout(() => flash(shared, 'active', 600), 2050);
    }

    // TRIGGER: Full cascade animation
    trigger?.addEventListener('click', runFullAnimation);

    // HINT: Also triggers full animation
    hintTrigger?.addEventListener('click', runFullAnimation);

    // WORKFLOW: Branch animation
    workflow?.addEventListener('click', () => {
      flash(workflow, 'active', 300);
      setTimeout(() => flash(connBranch, 'flowing', 600), 100);
      setTimeout(() => {
        agents.forEach((a, i) => {
          setTimeout(() => flash(a, 'processing', 650), i * 120);
        });
      }, 500);
    });

    // AGENTS: Process and flow to their DB
    agents.forEach((agent, idx) => {
      agent.addEventListener('click', () => {
        flash(agent, 'processing', 650);

        setTimeout(() => flash(connTrio, 'flowing', 500), 350);
        setTimeout(() => flash(dbs[idx], 'active', 500), 600);
      });
    });

    // DBs: Glow and merge to shared
    dbs.forEach(db => {
      db.addEventListener('click', () => {
        flash(db, 'active', 500);
        setTimeout(() => flash(connMerge, 'flowing', 500), 200);
        setTimeout(() => flash(shared, 'active', 600), 500);
      });
    });

    // SHARED: Just glow
    shared?.addEventListener('click', () => {
      flash(shared, 'active', 600);
    });
  });
</script>
